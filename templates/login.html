{% extends "base.html" %}

{% block title %}Iniciar sesión - MedCheck{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 70vh;">
  <div class="card p-4 p-md-5 shadow-lg" style="max-width: 420px; width: 100%; border-radius: 16px;">
    <div class="text-center mb-3">
      <img src="{{ url_for('static', path='img/logo.png') }}" alt="MedCheck" width="64" height="64" class="brand-logo">
      <h3 class="mt-2 mb-0" style="color: var(--brand-navy); font-weight: 700;">MedCheck</h3>
      <small class="text-muted">Accede a tu cuenta</small>
    </div>
    <div id="message" class="alert d-none" role="alert"></div>
    <form id="loginForm" class="mt-2">
      <div class="mb-3">
        <label for="username" class="form-label">Usuario</label>
        <input type="text" id="username" name="username" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Contraseña</label>
        <input type="password" id="password" name="password" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">Iniciar sesión</button>
    </form>
  </div>
  
</div>

<script>
  document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const messageDiv = document.getElementById('message');

    try {
      const formData = new FormData();
      formData.append('username', username);
      formData.append('password', password);

      const response = await fetch('/auth/login', {
        method: 'POST',
        body: formData,
        credentials: 'include'
      });

      if (response.ok) {
        messageDiv.textContent = '¡Login exitoso! Redirigiendo...';
        messageDiv.className = 'alert alert-success';
        messageDiv.classList.remove('d-none');
        setTimeout(() => { window.location.href = '/'; }, 500);
      } else {
        const error = await response.json();
        messageDiv.textContent = error.detail || 'Error al iniciar sesión';
        messageDiv.className = 'alert alert-danger';
        messageDiv.classList.remove('d-none');
      }
    } catch (error) {
      console.error('Error completo:', error);
      messageDiv.textContent = 'Error de conexión. Verifica tu red.';
      messageDiv.className = 'alert alert-danger';
      messageDiv.classList.remove('d-none');
    }
  });
</script>

{% endblock %}
